##Creating Playbooks (LAB11b)

Создайте статический файл инвентаризации в **review-playbooks/inventory** с **serverc.lab.example.com** в группе **ftpclients**, и **serverb.lab.example.com** и **serverd.lab.example.com** в группе **ftpservers**. Создайте файл **review-playbooks/ansible.cfg**, который настраивает ваш Ansible-проект для использования этого инвентаризационного файла. Возможно, вам будет полезно заглянуть в системный файл **/etc/ansible/ansible.cfg** для получения справки по синтаксису.

Настройте свой проект Ansible для подключения к узлам в inventory с использованием удаленного пользователя,
**devops** и метода **sudo** для повышения привилегий. У вас есть SSH-ключи для входа в систему, поскольку
**devops** уже настроен. Пользователю **devops** не нужен пароль для
повышения привилегий с помощью sudo.
Создайте сценарий (playbook) с именем **ftpclients.yml** в каталоге **review-playbooks**, который содержит операцию (play), ориентированную на хосты в инвентарной группе ftpclients. Playbook должен убедиться, что установлен пакет lftp.

Создайте второй сценарий с именем ansible-vsftpd.yml в каталоге review-playbooks, который содержит операцию, ориентированную на хосты в инвентарной группе ftpservers. Он должен соответствовать следующим требованиям:

- У вас есть файл конфигурации для **vsftpd**, созданный на основе шаблона Jinja2. Создайте каталог для шаблонов r**eview-playbooks/templates** и скопируйте в него предоставленный файл v**sftpd.conf.j2**. Создайте каталог **review-playbooks/vars**. Скопируйте предоставленный файл **defaults-template.yml**, который содержит настройки переменных по умолчанию, используемые для завершения этого шаблона при его развертывании, в каталог **review-playbooks/vars**
- Создайте файл переменных **review-playbooks/vars/vars.yml**, который задает три переменные:
  
| Variable | Value |
|:--|:--|
| vsftpd_package | vsftpd |
| vsftpd_service | vsftpd |
| sftpd_config_file | /etc/vsftpd/vsftpd.conf |

- В вашем сценарии **ansible-vsftpd.yml** используйте **vars_files** для включения файлов переменных в вашей операции в каталог **review-playbooks/vars**.
- В операции в  **ansible-vsftpd.yml** создайте задачи, которые:

  1. Убедитесь, что установлен пакет, указанный в переменной **{{ vsftpd_package }}**.
  2. Убедитесь, что служба, указанная в переменной **{{ vsftpd_service }}**, запущена и включена для запуска во время загрузки.
  3. Используйте модуль **template** для развертывания шаблона **templates/vsftpd.conf.j2** в расположении, определенном переменной **{{ vsftpd_config_file }}**. Файл должен принадлежать пользователю root, группе root, иметь права доступа к файлу 0600 и тип SELinux **etc_t**. Уведомите обработчик о перезапуске **vsftpd**, если эта задача приведет к изменению.
  4. Убедитесь, что пакет **firewalld** установлен, а служба запущена и включена. Убедитесь, что **firewalld** настроен на немедленное и постоянное разрешение подключений к службе **ftp**. Диапазон временных портов для пассивных подключений к передаче данных по FTP был установлен на 21000-21020 TCP. Вам также нужно будет разрешить этот диапазон через брандмауэр.

- В вашем справочнике **ansible-vsftpd.yml** создайте обработчик для перезапуска служб, перечисленных в переменной **{{ vsftpd_service }}** при получении уведомления. 

Создайте третий сценарий, **site.yml**, в каталоге **review-playbooks**. Этот сценарий должен импортировать только два других сценария. 
Следуйте рекомендациям учебника, называя все свои операции и задания. Напишите сценария, используя соответствующие модули, и убедитесь, что их можно безопасно перезапустить. Сценарии не должны вносить ненужных изменений в системы. 
Используйте команду **ansible-doc**, которая поможет вам найти модули и информацию о том, как их использовать. 
Когда закончите, используйте `ansible-playbook site.yml`, чтобы проверить свою работу. Вы также можете запустить отдельные сборники воспроизведения отдельно, чтобы убедиться, что они функционируют.
>Важно
>Если у вас возникли проблемы с вашим сценарием site.yml, убедитесь, что оба ansible-vsftpd.yml и ftpclients.yml использует последовательный отступ.