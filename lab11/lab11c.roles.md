##Creating Roles and Using Dynamic Inventory (LAB11c)

Настройте свой проект Ansible на использование скрипта динамической инвентаризации **crinventory.py** и статический файл инвентаризации **inventory**. 
Преобразуйте **ansible-vsftpd.yml** playbook в роль ansible-vsftpd, как указано ниже:
- Используйте команду **ansible-galaxy**, чтобы создать структуру каталогов для роли **ansible-vsftpd** в каталоге review-roles/roles в вашем проекте Ansible.
- Файл **defaults-template.yml** содержит переменные по умолчанию для роли. Переместите этот файл в соответствующее место в структуре каталогов роли.
- Файл **vars.yml** содержит обычные переменные для роли. Переместите этот файл в соответствующее место в структуре каталогов роли.
- Переместите шаблон **vsftpd.conf.j2** в соответствующее место в структуре каталогов ролей.
- Убедитесь, что задачи и обработчики в сценарии **ansible-vsftpd.yml** установлены соответствующим образом в роли.
- Отредактируйте файл role **meta/main.yml**, чтобы задать поля author, description и license (используйте BSD для лицензии). Отредактируйте **README.md** файл по мере необходимости для полноты.
- Удалите все подкаталоги в роли, которые вы не используете. 

Создайте новую книгу воспроизведения, vsftpd-configure.yml, в каталоге review-roles следующим образом.
- Сценарий должен содержать операцию, нацеленную на хосты в инвентарной группе ftpservers.
- В операции должны быть установлены следующие переменные:

| Variable | Value |
|:--|:--|
| vsftpd_anon_root | /mnt/share |
| vsftpd_local_root | /mnt/share |

- В операции должна применяться роль **ansible-vsftpd**.
- Операция должна включать следующие задачи в указанном порядке:
  1. Используйте модуль command для создания метки GPT-диска в **/dev/vdb**, которая начинается с 1 мбайт в начале устройства и заканчивается в конце устройства. Используйте команду **ansible-doc**, чтобы узнать, как использовать аргумент **creates**, чтобы пропустить эту задачу, если **/dev/vdb1** уже создан. Это позволяет избежать деструктивного перераспределения устройства. Используйте следующую команду для создания раздела: **`parted --script / dev/vdb mklabel gpt mkpart primary 1MiB 100%`** 
  2. Убедитесь, что каталог **/mnt/share** существует для использования в качестве точки монтирования.
  3. Используйте **ansible-doc -l**, чтобы найти модуль, который может создать файловую систему на блочном устройстве. Используйте **ansible-doc**, чтобы узнать, как использовать этот модуль. Добавьте в playbook задачу, которая использует этот модуль для создания файловой системы XFS в **/dev/vdb1**. Не создавайте принудительно эту файловую систему, если таковая уже существует.
  4. Добавьте задачу, чтобы убедиться, что **/etc/fstab** монтирует устройство **/dev/vdb1** в **/mnt/share** при загрузке и что оно в данный момент смонтировано. Используйте команду **ansible-doc**, чтобы найти модуль, который может монтировать устройство. Если эта задача имеет измененный результат, уведомите обработчик роли **ansible-vsftpd**, который перезапускает **vsftpd**.
  5. Добавьте задачу, которая гарантирует, что каталог **/mnt/share** принадлежит пользователю **root** и группе **root**, имеет тип SELinux, определенный в переменной **{{ vsftpd_setype }}** из роли, и имеет разрешения **0755**. Эта задача должна выполняться после монтирования файловой системы, чтобы установить разрешения для смонтированной файловой системы, а не для каталога точки монтирования-заполнителя.
  6. Убедитесь, что файл с именем **README** существует в каталоге, указанном **{{ vsftpd_anon_root }}**, содержащем строку **`Welcome to the FTP server at serverX.lab.example.com`** где **serverX.lab.example.com** является fully-qualified именем хоста для этого сервера. Этот файл должен иметь разрешения 0644 и тип SELinux, указанный переменной **{{ vsftpd_setype }}**. *(Подсказка: посмотрите на модули **copy** или **tamplate** и доступные факты Ansible, чтобы решить эту проблему.)*
   
>**Важно** 
>Возможно, вам будет полезно отладить свою роль, протестировав ее в playbook, который не содержит дополнительных задач или переменных playbook, перечисленных выше, но вместо этого содержит play, который нацелен только на хосты в группе **ftpservers** и применяет роль. 
>
>После подтверждения того, что упрощенный программа воспроизведения, использующая только роль, работает точно так же, как оригинальная программа воспроизведения ansible-vsftpd.yml, вы можете создать полную программу воспроизведения vsftpd-configure.yml, добавив дополнительные переменные и задачи, указанные выше.

Измените сценарий **review-roles/site.yml**, чтобы использовать новую конфигурацию **vsftpd-configure.yml** playbook вместо a**nsible-vsftpd.yml**. Следуйте рекомендациям, называя все свои операции и задания. Напишите сценарии, используя соответствующие модули, и убедитесь, что их можно безопасно перезапустить. Сценарии не должны вносить ненужных изменений в системы. Когда закончите, используйте **`ansible-playbook site.yml`**, чтобы проверить свою работу. Вы также можете запустить отдельные сценарии отдельно, чтобы убедиться, что они функционируют.