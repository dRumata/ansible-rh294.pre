LAB 4. Managing Variables and Facts. 

1. В рабочем каталоге создайте **playbook.yml** playbook и добавьте группу узлов веб-сервера в качестве управляемого узла. Определите следующие переменные воспроизведения:

| Variable | Values |
|:--|:--|
| firewall_pkg | firewalld |
| firewall_svc | firewalld |
| web_pkg | httpd |
| web_svc | httpd |
| ssl_pkg | mod_ssl |
| httpdconf_src | files/httpd.conf |
| httpdconf_dest | /etc/httpd/conf/httpd.conf |
| htaccess_src | files/.htaccess |
| secrets_dir | /etc/httpd/secrets |
| secrets_src | files/htpasswd |
| secrets_dest | "{{ secrets_dir }}/htpasswd" |
| web_root | /var/www/html |

2. Добавьте раздел задач в игру. Напишите задачу, которая гарантирует установку последней версии необходимых пакетов. Эти пакеты определяются переменными **firewall_pkg**, **web_pkg** и **ssl_pkg**.

3. Добавьте в playbook вторую задачу, которая гарантирует, что файл, указанный переменной **httpdconf_src**, был скопирован (с помощью модуля **copy**) в местоположение, указанное переменной **httpdconf_dest** на управляемом хосте. Файл должен принадлежать пользователю **root** и группе **root**. Также установите **0644** в качестве прав доступа к файлу.

4. Добавьте третью задачу, которая использует модуль **file** для создания каталога, указанного переменной **secrets_dir** на управляемом хосте. В этом каталоге хранятся файлы паролей, используемые для базовой аутентификации веб-служб. Файл должен принадлежать пользователю **apache** и группе **apache**. Установите **0500** в качестве прав доступа к файлам.

5. Добавьте четвертую задачу, которая использует модуль **copy** для размещения файла **htpasswd**, используемого для базовой аутентификации веб-пользователей. Источник должен быть определен переменной **secrets_src**. Пункт назначения должен быть определен переменной **secrets_dest**. Файл должен принадлежать пользователю и группе **apache**. Установите **0400** в качестве прав доступа к файлам.

6. Добавьте пятую задачу, которая использует модуль **copy** для создания файла **.htaccess** в корневом каталоге документа веб-сервера. Скопируйте файл, указанный переменной **htaccess_src**, в **{{ web_root }}/.htaccess**. Файл должен принадлежать пользователю **apache** и группе **apache**. Установите **0400** в качестве прав доступа к файлам.

7. Добавьте шестую задачу, которая использует модуль **copy** для создания файла веб-содержимого **index.html** в каталоге, указанном переменной **web_root**. Файл должен содержать сообщение “HOSTNAME (IPADDRESS) было настроено Ansible.”, где **HOSTNAME** - это полное имя хоста управляемого хоста, а **IPADDRESS** - это его IPv4-адрес. Используйте опцию **content** в модуле **copy**, чтобы указать содержимое файла, и Ansible facts, чтобы указать имя хоста и IP-адрес.

8. Добавьте седьмую задачу, которая использует модуль **service** для включения и запуска службы брандмауэра на управляемом хосте.

9. Добавьте восьмую задачу, которая использует модуль **firewalld**, чтобы разрешить службу **https**, необходимую пользователям для доступа к веб-службам на управляемом хосте. Это изменение брандмауэра должно быть постоянным и должно произойти немедленно.

10. Добавьте заключительную задачу, которая использует модуль **service** для включения и запуска веб-службы на управляемом хосте, чтобы все изменения конфигурации вступили в силу. Имя веб-службы определяется переменной **web_svc**.

11. Определите второй сценарий, указывающий на **localhost**, который будет тестировать аутентификацию на веб-сервере. Для этого не требуется повышение привилегий. Определите переменную с именем **web_user** со значением **guest**.

12. Добавьте в play директиву, которая добавляет дополнительные переменные из файла переменных с именем **vars/secret.yml**. Этот файл содержит переменную с именем **web_pass**, которая задает пароль для веб-пользователя. Вы создадите этот файл позже. Определите начало списка задач.

13. Добавьте два задания ко второму сценарию. Первый использует модуль **uri** для запроса содержимого с **https://serverb.lab.example.com** используя базовую аутентификацию. Используйте переменные **web_user** и **web_pass** для аутентификации на веб-сервере. Обратите внимание, что сертификат, представленный **serverb**, не будет надежным, поэтому вам нужно будет избегать проверки сертификата. Задача должна проверить возвращаемый код состояния HTTP, равный **200**. Настройте задачу таким образом, чтобы возвращаемое содержимое помещалось в переменную результатов задачи. Зарегистрируйте результат задачи в переменной. Вторая задача использует модуль **debug** для печати содержимого, возвращенного с веб-сервера.

14. Создайте файл, зашифрованный с помощью Ansible Vault, с именем **vars/secret.yml**. Используйте пароль **redhat** для его шифрования. Он должен установить для переменной **web_pass** значение **redhat**, которое будет паролем веб-пользователя.

15. Запустите **playbook.yml** playbook. Убедитесь, что содержимое успешно возвращено с веб-сервера и что оно соответствует тому, что было настроено в предыдущей задаче.