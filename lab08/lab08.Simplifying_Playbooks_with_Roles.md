LAB 8. Simplifying Playbooks with Roles.

1. Перейдите в рабочий каталог **/home/student/role-review**.

2. Создайте сборник воспроизведения с именем **web_dev_server.yml** с одним воспроизведением с именем **Configure Dev Web Server**. Настройте воспроизведение так, чтобы оно было нацелено на группу хостов dev_webserver. Пока не добавляйте в сценарий никаких ролей или заданий.
Убедитесь, что play принудительно запускает обработчики, потому что вы можете столкнуться с ошибкой при разработке playbook.

3. Проверьте синтаксис сборника воспроизведения. Запустите программу воспроизведения. Проверка синтаксиса должна пройти, и playbook должен быть успешно запущен.

4. Убедитесь, что установлены зависимости ролей playbook.
Роль **apache.developer_configs**, которую вы создадите, зависит от роли **infra.apache**. Создайте файл **roles/requirements.yml**. Он должен установить роль из репозитория **Git** по адресу **git@workstation.lab.example.com:infra/apache**, используйте версию v1.4 и назовите ее локально infra.apache. Вы можете предположить, что ваши SSH-ключи настроены таким образом, чтобы вы могли автоматически получать роли из этого репозитория. Установите роль с помощью команды ansible-galaxy.
Кроме того, установите пакет rhel-system-roles, если он отсутствует.

5. Инициализируйте новую роль с именем **apache.developer_configs** в подкаталоге **roles**.
Добавьте роль **infra.apache** в качестве зависимости для новой роли, используя ту же информацию для имени, источника, версии и системы управления версиями, что и в файле **roles/requirements.yml** **developer_tasks.yml** в каталоге проекта содержит задачи для роли. Переместите этот файл в правильное расположение, чтобы он был файлом задач для этой роли, и замените существующий файл в этом расположении.
Файл **developer.conf.j2** в каталоге проекта представляет собой шаблон **Jinja2**, используемый файлом задач. Переместите его в правильное расположение для файлов шаблонов, используемых этой ролью.

6. Роль **apache.developer_configs** обработает список пользователей, определенный в переменной с именем **web_developers**. Файл **web_developers.yml** в каталоге проекта определяет переменную списка пользователей **web_developers**. Просмотрите этот файл и используйте его для определения переменной **web_developers** для группы узлов веб-сервера разработки.
   
7. Добавьте роль **apache.developer_configs** для воспроизведения в **web_dev_server.yml**.

8. Проверьте синтаксис сборника воспроизведения. Запустите сценарий. Проверка синтаксиса должна пройти, но playbook должен завершиться неудачей, когда роль **infra.apache** попытается перезапустить Apache HTTPD.
   
9.  Apache HTTPD не удалось перезапустить на предыдущем шаге, поскольку сетевые порты, которые он использует для ваших разработчиков, помечены неправильными контекстами SELinux. Вам был предоставлен файл переменной **selinux.yml**, который можно использовать с **rhel-system-roles.selinux** для устранения проблемы.
Создайте раздел **pre_tasks** для вашего сценария в **web_dev_server.yml**. В этом разделе используйте задачу для включения **rhel-system-roles.selinux** роли в структуре **block/rescue**, чтобы она была правильно применена. Просмотрите лекцию или документацию для этой роли, чтобы узнать, как это сделать.
Проверьте файл **selinux.yml**. Переместите его в правильное местоположение, чтобы его переменные были установлены для группы узлов **dev_webserver**.

10. Проверьте синтаксис финального сценария. Проверка синтаксиса должна пройти.

11. Запустите сценарий. Это должно увенчаться успехом.

12. Протестируйте конфигурацию веб-сервера разработки. Убедитесь, что все конечные точки доступны и обслуживают контент каждого разработчика.